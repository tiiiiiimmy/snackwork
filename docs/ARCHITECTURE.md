è¿™æ˜¯æ ¹æ®ä¹‹å‰çš„å®¡æŸ¥æ„è§ï¼ˆè§£å†³åŒé‡ `src` è·¯å¾„é—®é¢˜ã€ä¼˜åŒ–å›¾ç‰‡å­˜å‚¨æ¶æ„ã€å¢åŠ ç¼“å­˜å±‚å’Œäº‹ä»¶å¤„ç†å±‚ï¼‰ä¿®æ”¹åçš„å®Œæ•´ **æ–‡ä»¶æ¶æ„è®¾è®¡æ–‡æ¡£**ã€‚

ä¸»è¦å˜æ›´ç‚¹ï¼š

1. **ç›®å½•æ‰å¹³åŒ–**ï¼šç§»é™¤äº†æ ¹ç›®å½•ä¸‹çš„ `src/`ï¼Œ`frontend` å’Œ `backend` ç›´æ¥ä½œä¸ºæ ¹ç›®å½•çš„ä¸€çº§å­ç›®å½•ã€‚
2. **å›¾ç‰‡å­˜å‚¨**ï¼šåç«¯å¢åŠ äº† `wwwroot/uploads` ç›®å½•ï¼Œæ˜ç¡®é‡‡ç”¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨å›¾ç‰‡è€Œéæ•°æ®åº“ Blobã€‚
3. **ç¼“å­˜ä¸äº‹ä»¶**ï¼šåç«¯å¢åŠ äº† `Infrastructure/Caching` å’Œ `Core/Events` ç›®å½•ï¼Œä»¥æ”¯æŒé«˜æ€§èƒ½æ¨èå’Œæ¸¸æˆåŒ–è§£è€¦ã€‚
4. **ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šå‰ç«¯å¢åŠ äº† `styles/mobile` å’Œ `pwa` ä¸“ç”¨ç›®å½•ã€‚

---

# SnackSpot Auckland v2.0 - æ–‡ä»¶æ¶æ„è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ•´ä½“æ¶æ„

### 1.1 é¡¹ç›®ç»“æ„

æœ¬é¡¹ç›®é‡‡ç”¨ **Monorepo** ç»“æ„ï¼Œå‰ç«¯å’Œåç«¯ä»£ç åœ¨åŒä¸€ä¸ªä»“åº“ä¸­ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ã€‚ä¸ºäº†é¿å…è·¯å¾„å†—ä½™ï¼Œæ ¹ç›®å½•ç›´æ¥åŒ…å«å‰åç«¯å­é¡¹ç›®ã€‚

```text
snackwork/
â”œâ”€â”€ .github/                    # GitHubé…ç½®
â”‚   â””â”€â”€ workflows/              # CI/CDå·¥ä½œæµ
â”œâ”€â”€ backend/                    # åç«¯é¡¹ç›® (.NET 9.0)
â”‚   â”œâ”€â”€ SnackSpotAuckland.Api/
â”‚   â”œâ”€â”€ SnackSpotAuckland.Tests/
â”‚   â””â”€â”€ SnackSpotAuckland.sln
â”œâ”€â”€ frontend/                   # å‰ç«¯é¡¹ç›® (React + TypeScript)
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md         # æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚   â”œâ”€â”€ CODING_STANDARDS.md     # å¼€å‘è§„èŒƒæ–‡æ¡£
â”‚   â””â”€â”€ DEPLOYMENT.md           # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ plan/                       # äº§å“è§„åˆ’å’Œè§„æ ¼æ–‡æ¡£
â”‚   â”œâ”€â”€ product-spec-v2.0.md
â”‚   â””â”€â”€ recommendation-implementation-v4.md
â”œâ”€â”€ scripts/                    # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ database/               # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh               # éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ setup-dev.sh            # å¼€å‘ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â””â”€â”€ LICENSE                     # è®¸å¯è¯

```

### 1.2 ç›®å½•å‘½åè§„èŒƒ

* **å°å†™å­—æ¯ + è¿å­—ç¬¦**ï¼šç”¨äºé¡¶å±‚ç›®å½•åï¼ˆå¦‚ `frontend`, `backend`ï¼‰
* **PascalCase**ï¼šç”¨äº .NET é¡¹ç›®æ–‡ä»¶å’Œç»„ä»¶æ–‡ä»¶åï¼ˆå¦‚ `UserProfile.tsx`, `UserService.cs`ï¼‰
* **camelCase**ï¼šç”¨äºå‰ç«¯å·¥å…·æ–‡ä»¶ã€å˜é‡å’Œå‡½æ•°å
* **UPPER_CASE**ï¼šç”¨äºå¸¸é‡æ–‡ä»¶

---

## 2. å‰ç«¯æ–‡ä»¶æ¶æ„

### 2.1 å‰ç«¯ç›®å½•ç»“æ„ (`frontend/`)

```text
frontend/
â”œâ”€â”€ public/                     # é™æ€èµ„æº (ä¸ç»è¿‡æ„å»ºå¤„ç†)
â”‚   â”œâ”€â”€ icons/                  # PWAå›¾æ ‡
â”‚   â”œâ”€â”€ manifest.json           # PWAé…ç½®
â”‚   â”œâ”€â”€ robots.txt
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/                        # æºä»£ç 
â”‚   â”œâ”€â”€ assets/                 # é™æ€èµ„æº (ç»è¿‡æ„å»ºå¤„ç†)
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ fonts/
â”‚   â”œâ”€â”€ components/             # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/             # é€šç”¨UIç»„ä»¶ (Button, Inputç­‰)
â”‚   â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶ (Header, BottomNav)
â”‚   â”‚   â”œâ”€â”€ features/           # ä¸šåŠ¡åŠŸèƒ½ç»„ä»¶ (æŒ‰é¢†åŸŸåˆ’åˆ†)
â”‚   â”‚   â”‚   â”œâ”€â”€ snack/          # é›¶é£Ÿç›¸å…³ (SnackCard, SnackForm)
â”‚   â”‚   â”‚   â”œâ”€â”€ store/          # å•†åº—ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ user/           # ç”¨æˆ·ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ review/         # è¯„ä»·ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ feed/           # ä¿¡æ¯æµç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ gamification/   # æ¸¸æˆåŒ– (Badges, Leaderboard)
â”‚   â”œâ”€â”€ hooks/                  # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useSnacks.ts
â”‚   â”‚   â””â”€â”€ useInfiniteScroll.ts
â”‚   â”œâ”€â”€ pages/                  # é¡µé¢ç»„ä»¶ (å¯¹åº”è·¯ç”±)
â”‚   â”‚   â”œâ”€â”€ Home.tsx
â”‚   â”‚   â”œâ”€â”€ Discover.tsx
â”‚   â”‚   â”œâ”€â”€ CreateSnack.tsx
â”‚   â”‚   â”œâ”€â”€ Profile.tsx
â”‚   â”‚   â””â”€â”€ SnackDetail.tsx
â”‚   â”œâ”€â”€ services/               # APIæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ api.ts              # Axioså®ä¾‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ authService.ts
â”‚   â”‚   â””â”€â”€ snackService.ts
â”‚   â”œâ”€â”€ context/                # React Context (å…¨å±€çŠ¶æ€)
â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ styles/                 # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ mobile/             # ç§»åŠ¨ç«¯ç‰¹å®šé€‚é…æ ·å¼
â”‚   â”‚   â”œâ”€â”€ _variables.scss
â”‚   â”‚   â”œâ”€â”€ _mixins.scss
â”‚   â”‚   â””â”€â”€ main.scss
â”‚   â”œâ”€â”€ pwa/                    # PWA ç›¸å…³é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ serviceWorkerRegistration.ts
â”‚   â”‚   â””â”€â”€ custom-sw.js        # è‡ªå®šä¹‰ Service Worker é€»è¾‘
â”‚   â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶ (è·¯ç”±, ç¯å¢ƒå˜é‡)
â”‚   â”œâ”€â”€ App.tsx                 # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.tsx                # å…¥å£æ–‡ä»¶
â”œâ”€â”€ vite.config.ts              # Viteé…ç½®
â”œâ”€â”€ tsconfig.json               # TypeScripté…ç½®
â””â”€â”€ package.json

```

### 2.2 ç»„ä»¶ç»„ç»‡åŸåˆ™

**Feature-based ç»„ç»‡**ï¼šåœ¨ `components/features` ä¸‹æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ†ç»„ï¼Œé¿å… `components` æ ¹ç›®å½•ä¸‹æ–‡ä»¶çˆ†ç‚¸ã€‚

```text
components/features/snack/
â”œâ”€â”€ SnackCard/
â”‚   â”œâ”€â”€ SnackCard.tsx
â”‚   â”œâ”€â”€ SnackCard.module.scss
â”‚   â””â”€â”€ index.ts
â””â”€â”€ SnackList/
    â”œâ”€â”€ SnackList.tsx
    â””â”€â”€ SnackList.module.scss

```

---

## 3. åç«¯æ–‡ä»¶æ¶æ„

### 3.1 åç«¯ç›®å½•ç»“æ„ (`backend/`)

é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œå¹¶é’ˆå¯¹ **è‡ªæ‰˜ç®¡å›¾ç‰‡å­˜å‚¨** å’Œ **ç¼“å­˜æ€§èƒ½** è¿›è¡Œäº†ä¼˜åŒ–ã€‚

```text
backend/
â”œâ”€â”€ SnackSpotAuckland.Api/      # ä¸»APIé¡¹ç›®
â”‚   â”œâ”€â”€ Controllers/            # æ§åˆ¶å™¨ (APIå…¥å£)
â”‚   â”‚   â””â”€â”€ V1/
â”‚   â”‚       â”œâ”€â”€ SnacksController.cs
â”‚   â”‚       â”œâ”€â”€ AuthController.cs
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ Core/                   # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (è§£è€¦å±‚)
â”‚   â”‚   â”œâ”€â”€ Interfaces/         # æœåŠ¡æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ Entities/           # æ•°æ®åº“å®ä½“ (User, Snack)
â”‚   â”‚   â”œâ”€â”€ Events/             # é¢†åŸŸäº‹ä»¶ (SnackCreatedEvent.cs)
â”‚   â”‚   â””â”€â”€ DTOs/               # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ Requests/
â”‚   â”‚       â””â”€â”€ Responses/
â”‚   â”œâ”€â”€ Infrastructure/         # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ Data/               # æ•°æ®åº“ä¸Šä¸‹æ–‡ (DbContext)
â”‚   â”‚   â”œâ”€â”€ Repositories/       # æ•°æ®è®¿é—®ä»“å‚¨
â”‚   â”‚   â”œâ”€â”€ Services/           # å¤–éƒ¨æœåŠ¡å®ç° (Email, FileStorage)
â”‚   â”‚   â””â”€â”€ Caching/            # ç¼“å­˜å®ç° (MemoryCache/Rediså°è£…)
â”‚   â”œâ”€â”€ Services/               # ä¸šåŠ¡æœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ SnackService.cs
â”‚   â”‚   â”œâ”€â”€ RecommendationService.cs
â”‚   â”‚   â””â”€â”€ EventHandlers/      # äº‹ä»¶å¤„ç†å™¨ (å¤„ç†æ¸¸æˆåŒ–é€»è¾‘: UserXpHandler.cs)
â”‚   â”œâ”€â”€ wwwroot/                # é™æ€æ–‡ä»¶æ ¹ç›®å½• (è‡ªæ‰˜ç®¡å­˜å‚¨)
â”‚   â”‚   â””â”€â”€ uploads/
â”‚   â”‚       â””â”€â”€ images/         # ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ (ä¸å­˜æ•°æ®åº“!)
â”‚   â”œâ”€â”€ Extensions/             # æ‰©å±•æ–¹æ³• (ServiceCollectionExtensions.cs)
â”‚   â”œâ”€â”€ Middleware/             # ä¸­é—´ä»¶ (ErrorHandling, RateLimiting)
â”‚   â”œâ”€â”€ Mappings/               # AutoMapperé…ç½®
â”‚   â”œâ”€â”€ Validators/             # FluentValidationéªŒè¯å™¨
â”‚   â”œâ”€â”€ Program.cs              # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ appsettings.json        # é…ç½®æ–‡ä»¶
â”‚
â””â”€â”€ SnackSpotAuckland.Tests/    # æµ‹è¯•é¡¹ç›®
    â”œâ”€â”€ Integration/            # é›†æˆæµ‹è¯•
    â””â”€â”€ Unit/                   # å•å…ƒæµ‹è¯•

```

### 3.2 å…³é”®æ¶æ„å†³ç­–è¯´æ˜

#### 3.2.1 å›¾ç‰‡å­˜å‚¨ä¼˜åŒ– (`wwwroot/uploads`)

* **å˜æ›´**ï¼šæ”¾å¼ƒå°†å›¾ç‰‡å­˜å…¥ MySQL Blob çš„æ–¹æ¡ˆã€‚
* **è®¾è®¡**ï¼šä½¿ç”¨ç‰©ç†æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ã€‚
* **è·¯å¾„**ï¼š`backend/SnackSpotAuckland.Api/wwwroot/uploads/images/{yyyy}/{mm}/{guid}.jpg`
* **æ•°æ®åº“**ï¼šä»…å­˜å‚¨ç›¸å¯¹è·¯å¾„ `/uploads/images/...`ã€‚

#### 3.2.2 ç¼“å­˜å±‚ (`Infrastructure/Caching`)

* **ç›®çš„**ï¼šæ”¯æŒé«˜æ€§èƒ½æ¨èä¿¡æ¯æµã€‚
* **è®¾è®¡**ï¼šå®šä¹‰ `ICacheService` æ¥å£ï¼ŒåˆæœŸå®ç° `MemoryCacheService`ï¼Œæœªæ¥å¯æ— ç¼æ›¿æ¢ä¸º `RedisCacheService`ã€‚

#### 3.2.3 äº‹ä»¶è§£è€¦ (`Services/EventHandlers`)

* **ç›®çš„**ï¼šè§£å†³ "å‘å¸ƒé›¶é£Ÿ" ä¸ "å¢åŠ ç»éªŒå€¼" çš„ä»£ç è€¦åˆã€‚
* **æµç¨‹**ï¼š
1. `SnackService` å®Œæˆåˆ›å»ºåï¼Œå‘å¸ƒ `SnackCreatedEvent`ã€‚
2. `UserXpHandler` è®¢é˜…è¯¥äº‹ä»¶ï¼Œå¼‚æ­¥å¤„ç†ç»éªŒå€¼å¢åŠ å’Œç­‰çº§è®¡ç®—ã€‚



---

## 4. æ•°æ®åº“ç›¸å…³

### 4.1 è¿ç§»æ–‡ä»¶ç»„ç»‡

ä½äº `backend/SnackSpotAuckland.Api/Migrations/`ã€‚

### 4.2 æ•°æ®åº“åˆå§‹åŒ–

ä½äº `scripts/database/`ï¼š

* `init.sql`: æ•°æ®åº“ç”¨æˆ·æƒé™è®¾ç½®ã€‚
* `schema.sql`: ä»…åœ¨é EF Core æ¨¡å¼ä¸‹ä½¿ç”¨çš„è¡¨ç»“æ„è„šæœ¬ã€‚

---

## 5. éƒ¨ç½²ç›¸å…³

### 5.1 é…ç½®æ–‡ä»¶

**å‰ç«¯ (`frontend/`)**:

* `.env.production`: ç”Ÿäº§ç¯å¢ƒ API åœ°å€é…ç½®ã€‚
* `nginx.conf`: å‰ç«¯é™æ€èµ„æºæœåŠ¡å™¨é…ç½®ã€‚

**åç«¯ (`backend/`)**:

* `appsettings.Production.json`: ç”Ÿäº§æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² (æ³¨æ„: æ•æ„Ÿä¿¡æ¯åº”é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥)ã€‚

### 5.2 ç›®å½•æŒ‚è½½ (Docker)

åœ¨éƒ¨ç½²æ—¶ï¼Œéœ€è¦ç¡®ä¿ä¸Šä¼ ç›®å½•æŒä¹…åŒ–ï¼š

* ä¸»æœºç›®å½• `/var/www/snackspot/uploads` æŒ‚è½½åˆ°å®¹å™¨å†… `/app/wwwroot/uploads`ã€‚

---

## 6. æµ‹è¯•æ–‡ä»¶ç»„ç»‡

### 6.1 å‰ç«¯æµ‹è¯• (`frontend/src/`)

æµ‹è¯•æ–‡ä»¶ä¸ç»„ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œä¾¿äºç»´æŠ¤ï¼š

* `Component.test.tsx` (å•å…ƒæµ‹è¯•)

### 6.2 åç«¯æµ‹è¯• (`backend/SnackSpotAuckland.Tests/`)

* **Unit**: æµ‹è¯• Service é€»è¾‘ï¼ŒMock æ•°æ®åº“å’Œå¤–éƒ¨ä¾èµ–ã€‚
* **Integration**: ä½¿ç”¨ `WebApplicationFactory` æµ‹è¯•å®Œæ•´ API æµç¨‹ (Controller -> Service -> In-Memory DB)ã€‚

---

## 7. ç›®å½•ç»“æ„å¯è§†åŒ– (ä¿®æ­£ç‰ˆ)

```text
snackwork/
â”‚
â”œâ”€â”€ .github/                    # CI/CD
â”‚
â”œâ”€â”€ docs/                       # ğŸ“š æ–‡æ¡£ä¸­å¿ƒ
â”‚
â”œâ”€â”€ plan/                       # ğŸ“‹ äº§å“è§„åˆ’
â”‚
â”œâ”€â”€ scripts/                    # ğŸ”§ è¿ç»´è„šæœ¬
â”‚
â”œâ”€â”€ frontend/                   # âš›ï¸ React å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ public/                 # PWA å›¾æ ‡ç­‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ features/       # ä¸šåŠ¡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/              # è·¯ç”±é¡µé¢
â”‚   â”‚   â”œâ”€â”€ services/           # API è°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”‚   â””â”€â”€ mobile/         # ğŸ“± ç§»åŠ¨ç«¯é€‚é…
â”‚   â”‚   â””â”€â”€ pwa/                # Service Worker
â”‚   â””â”€â”€ vite.config.ts
â”‚
â””â”€â”€ backend/                    # ğŸ”· .NET åç«¯åº”ç”¨
    â”œâ”€â”€ SnackSpotAuckland.Api/
    â”‚   â”œâ”€â”€ Controllers/
    â”‚   â”œâ”€â”€ Core/               # å®ä½“ä¸æ¥å£
    â”‚   â”œâ”€â”€ Services/           # ä¸šåŠ¡é€»è¾‘
    â”‚   â”‚   â””â”€â”€ EventHandlers/  # ğŸ® æ¸¸æˆåŒ–é€»è¾‘è§£è€¦
    â”‚   â”œâ”€â”€ Infrastructure/
    â”‚   â”‚   â””â”€â”€ Caching/        # ğŸš€ ç¼“å­˜å±‚
    â”‚   â””â”€â”€ wwwroot/
    â”‚       â””â”€â”€ uploads/        # ğŸ–¼ï¸ å›¾ç‰‡å­˜å‚¨ (æŒ‚è½½å·)
    â””â”€â”€ SnackSpotAuckland.Tests/

```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.1
**å˜æ›´è®°å½•**:

* 2025-01-27 v1.0: åˆå§‹ç‰ˆæœ¬
* 2025-01-27 v2.0: ä¿®æ­£æ ¹ç›®å½•ç»“æ„ï¼Œæ¶ˆé™¤ "double src" é—®é¢˜ï¼›ä¼˜åŒ–å›¾ç‰‡å­˜å‚¨æ¶æ„ï¼›å¢åŠ ç¼“å­˜ä¸äº‹ä»¶å±‚è®¾è®¡ã€‚